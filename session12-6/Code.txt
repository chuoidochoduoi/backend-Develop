DO $$
DECLARE
    sender_id INT := 1;      
    receiver_id INT := 2;    
    amount NUMERIC := 200;   
    current_balance NUMERIC;
BEGIN
    SELECT balance INTO current_balance FROM accounts WHERE account_id = sender_id;

    IF current_balance >= amount THEN
        UPDATE accounts SET balance = balance - amount WHERE account_id = sender_id;
        UPDATE accounts SET balance = balance + amount WHERE account_id = receiver_id;
        
        RAISE NOTICE 'Giao dịch thành công. Đang COMMIT...';
    ELSE
        RAISE EXCEPTION 'Giao dịch thất bại: Tài khoản không đủ số dư! (Hiện có: %)', current_balance;
    END IF;
END $$;