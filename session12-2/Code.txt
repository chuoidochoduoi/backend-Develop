
create or replace function check_product()
returns trigger
language plpgsql
as $$
    BEGIN
        if ((select stock from products where product_id= new.product_id) < new.quantity) then raise exception 'ko du so luong';
        end if;
        return new;
    end;
    $$;
create or replace trigger aaa
    BEFORE insert on sales
    for each row execute function check_product()

insert into sales(product_id, quantity) VALUES (1,2)