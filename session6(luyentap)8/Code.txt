
CREATE TABLE Customer ( id SERIAL PRIMARY KEY, name VARCHAR(100) );

INSERT INTO Customer (name) VALUES
                                ('Nguyễn Văn A'),
                                ('Trần Thị B'),
                                ('Lê Văn C'),
                                ('Phạm Thị D'),
                                ('Hoàng Văn E'),
                                ('Đỗ Thị F'),
                                ('Vũ Văn G'),
                                ('Bùi Thị H'),
                                ('Phan Văn I'),
                                ('Ngô Thị K');


select c.name,sum(o.total_amount) from customer c join orders o on c.id = o.customer_id group by c.id

SELECT t.name, t.total
FROM (
         SELECT c.name AS name, SUM(o.total_amount) AS total
         FROM customer c
                  JOIN orders o ON c.id = o.customer_id
         GROUP BY c.name
     ) t
WHERE t.total = (SELECT MAX(total)
                 FROM (
                          SELECT SUM(o.total_amount) AS total
                          FROM customer c
                                   JOIN orders o ON c.id = o.customer_id
                          GROUP BY c.name
                      ) x);

select c.name from customer c left join Orders O on c.id = O.customer_id where o.id isnull

select c.name,sum(o.total_amount) from customer c join orders o on c.id = o.customer_id group by c.id having sum(o.total_amount) > (select avg(o.total_amount) from customer c join orders o on c.id = o.customer_id )
