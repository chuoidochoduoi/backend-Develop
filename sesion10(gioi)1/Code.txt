
CREATE OR REPLACE FUNCTION LOGEM()
RETURNS TRIGGER
LANGUAGE plpgsql
AS $$
    BEGIN
        CASE TG_OP
            WHEN 'INSERT' THEN
                INSERT INTO sales_schema.employees_log(employee_id, operation, old_data, new_data)
                VALUES (NEW.id, 'INSERT', NULL, to_jsonb(NEW));
                RETURN NEW;

            WHEN 'UPDATE' THEN
                INSERT INTO sales_schema.employees_log(employee_id, operation, old_data, new_data)
                VALUES (NEW.id, 'UPDATE', to_jsonb(OLD), to_jsonb(NEW));
                RETURN NEW;

            WHEN 'DELETE' THEN
                INSERT INTO sales_schema.employees_log(employee_id, operation, old_data, new_data)
                VALUES (OLD.id, 'DELETE', to_jsonb(OLD), NULL);
                RETURN OLD;
            END CASE;
    end;

    $$;

create or replace trigger aaab
    AFTER insert or update or DELETE on employees
    for each row execute function LOGEM();
